<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python File Handling - Complete Guide</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3776ab;
            --secondary-color: #ffd43b;
            --accent-color: #306998;
            --text-color: #333;
            --bg-color: #ffffff;
            --card-bg: #ffffff;
            --shadow: 0 8px 32px rgba(0,0,0,0.1);
            --border-radius: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --primary-color: #4a9eff;
            --secondary-color: #ffd43b;
            --accent-color: #66b3ff;
            --text-color: #e0e0e0;
            --bg-color: #1a1a1a;
            --card-bg: #2d2d2d;
            --shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%);
            min-height: 100vh;
            transition: var(--transition);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(55, 118, 171, 0.1);
            border: none;
            color: var(--primary-color);
            padding: 12px 16px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: rgba(55, 118, 171, 0.2);
            transform: scale(1.05);
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(55, 118, 171, 0.1);
            border: none;
            color: var(--primary-color);
            padding: 12px 16px;
            border-radius: 50px;
            cursor: pointer;
            text-decoration: none;
            font-size: 1rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-button:hover {
            background: rgba(55, 118, 171, 0.2);
            transform: translateX(-5px);
        }

        .main-title {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            color: var(--text-color);
        }

        /* Navigation */
        .nav-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .nav-title {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .nav-item {
            padding: 15px 20px;
            background: rgba(55, 118, 171, 0.05);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-item:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(55, 118, 171, 0.3);
        }

        .nav-item i {
            font-size: 1.2rem;
            color: var(--primary-color);
            transition: var(--transition);
        }

        .nav-item:hover i {
            color: white;
        }

        /* Content Sections */
        .content-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary-color);
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--secondary-color);
        }

        .subsection {
            margin-bottom: 30px;
        }

        .subsection-title {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .subsection-title i {
            color: var(--primary-color);
        }

        .content-text {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 20px;
            color: var(--text-color);
            opacity: 0.9;
        }

        /* Code blocks */
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            overflow-x: auto;
            position: relative;
            border-left: 4px solid var(--primary-color);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .code-block::before {
            content: 'Python';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 0.8rem;
            color: var(--primary-color);
            background: rgba(55, 118, 171, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* Lists */
        .feature-list {
            list-style: none;
            margin: 20px 0;
        }

        .feature-list li {
            padding: 12px 0;
            position: relative;
            padding-left: 35px;
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .feature-list li::before {
            content: 'üêç';
            position: absolute;
            left: 0;
            font-size: 1.2rem;
        }

        /* Tables */
        .mode-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .mode-table th,
        .mode-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(55, 118, 171, 0.1);
        }

        .mode-table th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        .mode-table tr:nth-child(even) {
            background: rgba(55, 118, 171, 0.05);
        }

        .mode-table tr:hover {
            background: rgba(55, 118, 171, 0.1);
        }

        /* Warning/Info boxes */
        .info-box {
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid var(--primary-color);
            background: rgba(55, 118, 171, 0.05);
        }

        .warning-box {
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #ff6b35;
            background: rgba(255, 107, 53, 0.05);
        }

        .info-box .box-title,
        .warning-box .box-title {
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-box .box-title {
            color: var(--primary-color);
        }

        .warning-box .box-title {
            color: #ff6b35;
        }

        /* Exercise sections */
        .exercise-section {
            background: linear-gradient(135deg, rgba(55, 118, 171, 0.1), rgba(48, 105, 152, 0.05));
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid rgba(55, 118, 171, 0.1);
        }

        .exercise-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exercise-list {
            list-style: none;
        }

        .exercise-list li {
            padding: 10px 0;
            position: relative;
            padding-left: 30px;
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .exercise-list li::before {
            content: 'üí°';
            position: absolute;
            left: 0;
            font-size: 1.1rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-title {
                font-size: 2rem;
            }
            
            .nav-grid {
                grid-template-columns: 1fr;
            }
            
            .back-button,
            .theme-toggle {
                position: static;
                margin: 10px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .content-section {
                padding: 25px;
            }
            
            .code-block {
                padding: 20px;
                font-size: 0.9rem;
            }
        }

        /* Scroll to top button */
        .scroll-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            opacity: 0;
            visibility: hidden;
        }

        .scroll-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .scroll-top:hover {
            background: var(--accent-color);
            transform: translateY(-3px);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <a href="index.html" class="back-button">
                <i class="fas fa-arrow-left"></i>
                Back to Hub
            </a>
            <button class="theme-toggle" onclick="toggleTheme()">
                <i class="fas fa-moon" id="theme-icon"></i>
            </button>
            
            <h1 class="main-title">Python File Handling</h1>
            <p class="subtitle">Complete Guide to File Operations, Context Managers, and Advanced Techniques</p>
        </header>

        <!-- Navigation -->
        <section class="nav-section">
            <h2 class="nav-title">Quick Navigation</h2>
            <div class="nav-grid">
                <a href="#why-file-handling" class="nav-item">
                    <i class="fas fa-question-circle"></i>
                    Why File Handling?
                </a>
                <a href="#file-basics" class="nav-item">
                    <i class="fas fa-file"></i>
                    File Basics
                </a>
                <a href="#file-modes" class="nav-item">
                    <i class="fas fa-cog"></i>
                    File Modes
                </a>
                <a href="#reading-writing" class="nav-item">
                    <i class="fas fa-edit"></i>
                    Reading & Writing
                </a>
                <a href="#context-managers" class="nav-item">
                    <i class="fas fa-shield-alt"></i>
                    Context Managers
                </a>
                <a href="#random-access" class="nav-item">
                    <i class="fas fa-random"></i>
                    Random Access
                </a>
                <a href="#binary-files" class="nav-item">
                    <i class="fas fa-file-code"></i>
                    Binary Files
                </a>
                <a href="#advanced-techniques" class="nav-item">
                    <i class="fas fa-rocket"></i>
                    Advanced Techniques
                </a>
                <a href="#best-practices" class="nav-item">
                    <i class="fas fa-star"></i>
                    Best Practices
                </a>
                <a href="#student-location-system" class="nav-item">
                    <i class="fas fa-user-graduate"></i>
                    Student Location System
                </a>
                <a href="#unix-part" class="nav-item">
                    <i class="fas fa-terminal"></i>
                    Unix Part
                </a>
                <a href="#exam-questions" class="nav-item">
                    <i class="fas fa-graduation-cap"></i>
                    Exam Questions
                </a>
            </div>
        </section>

        <!-- Why File Handling -->
        <section id="why-file-handling" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-question-circle"></i>
                1. Why File Handling is Needed
            </h2>
            
            <div class="content-text">
                Before file handling, all the programs you've written run in RAM (volatile memory). Once your program stops, everything in RAM is erased.
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-database"></i>
                    Why we need files:
                </h3>
                
                <ul class="feature-list">
                    <li><strong>Persistence of data:</strong> Without files, any data disappears when the program ends. Files store data permanently in secondary storage (disk).</li>
                    <li><strong>Handling large datasets:</strong> Inputting thousands of lines via console is tedious. You can store the data in a file and read it into the program.</li>
                    <li><strong>Limited memory:</strong> RAM is small; storing and displaying huge data in memory can be impractical. Use files to store large data and read/write only parts as needed.</li>
                </ul>
            </div>
        </section>

        <!-- File Basics -->
        <section id="file-basics" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-file"></i>
                2. What is a File?
            </h2>
            
            <div class="content-text">
                A file is a named location on disk that stores data permanently.
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-list"></i>
                    Files can store:
                </h3>
                
                <ul class="feature-list">
                    <li><strong>Text (human-readable):</strong> Characters, numbers, and symbols that can be read by humans</li>
                    <li><strong>Binary (non-human-readable):</strong> Data in binary format (0s and 1s)</li>
                </ul>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-file-alt"></i>
                    3. Types of Files
                </h3>
                
                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">3.1 Text Files</h4>
                <div class="content-text">
                    Store characters, numbers, and symbols in human-readable form. Can be opened in any text editor.
                </div>
                <div class="info-box">
                    <div class="box-title">
                        <i class="fas fa-info-circle"></i>
                        Examples
                    </div>
                    .txt, .csv, .py, .json
                </div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">3.2 Binary Files</h4>
                <div class="content-text">
                    Store data in binary format (0s and 1s), not directly readable. Used for images, audio, video, executables, compressed files.
                </div>
                <div class="info-box">
                    <div class="box-title">
                        <i class="fas fa-info-circle"></i>
                        Examples
                    </div>
                    .jpg, .mp3, .exe, .zip
                </div>
            </div>
        </section>

        <!-- File Operations -->
        <section class="content-section">
            <h2 class="section-title">
                <i class="fas fa-cogs"></i>
                4. Basic File Operations in Python
            </h2>
            
            <div class="content-text">
                The four main operations are:
            </div>

            <ul class="feature-list">
                <li><strong>Open a file:</strong> Create a connection to the file</li>
                <li><strong>Read data from a file:</strong> Retrieve content from the file</li>
                <li><strong>Write data to a file:</strong> Store content in the file</li>
                <li><strong>Close the file:</strong> Terminate the connection</li>
            </ul>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-plus-circle"></i>
                    Other useful operations:
                </h3>
                
                <ul class="feature-list">
                    <li><strong>Seek:</strong> Move the file pointer to a specific position</li>
                    <li><strong>Tell:</strong> Get current file pointer position</li>
                </ul>
            </div>
        </section>

        <!-- Opening Files -->
        <section class="content-section">
            <h2 class="section-title">
                <i class="fas fa-folder-open"></i>
                5. Opening a File
            </h2>
            
            <div class="content-text">
                We use Python's built-in <code>open()</code> function:
            </div>

            <div class="code-block">file_object = open(filename, mode)</div>

            <ul class="feature-list">
                <li><strong>filename:</strong> Name or full path of the file</li>
                <li><strong>mode:</strong> Specifies read/write/append and text/binary</li>
                <li><strong>Returns:</strong> A file object (file handler/pointer)</li>
            </ul>

            <div class="info-box">
                <div class="box-title">
                    <i class="fas fa-info-circle"></i>
                    File Pointer
                </div>
                Tracks the current position in the file.
            </div>
        </section>

        <!-- File Modes -->
        <section id="file-modes" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-cog"></i>
                6. File Modes
            </h2>
            
            <table class="mode-table">
                <thead>
                    <tr>
                        <th>Mode</th>
                        <th>Meaning</th>
                        <th>Pointer Position</th>
                        <th>Creates File?</th>
                        <th>Overwrites?</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>r</code></td>
                        <td>Read (text)</td>
                        <td>Beginning</td>
                        <td>No</td>
                        <td>No</td>
                        <td>Error if file doesn't exist</td>
                    </tr>
                    <tr>
                        <td><code>w</code></td>
                        <td>Write (text)</td>
                        <td>Beginning</td>
                        <td>Yes</td>
                        <td>Yes</td>
                        <td>Erases existing content</td>
                    </tr>
                    <tr>
                        <td><code>a</code></td>
                        <td>Append (text)</td>
                        <td>End</td>
                        <td>Yes</td>
                        <td>No</td>
                        <td>Adds new data at end</td>
                    </tr>
                    <tr>
                        <td><code>r+</code></td>
                        <td>Read & Write (text)</td>
                        <td>Beginning</td>
                        <td>No</td>
                        <td>No</td>
                        <td>Can overwrite parts</td>
                    </tr>
                    <tr>
                        <td><code>w+</code></td>
                        <td>Write & Read (text)</td>
                        <td>Beginning</td>
                        <td>Yes</td>
                        <td>Yes</td>
                        <td>Erases existing content</td>
                    </tr>
                    <tr>
                        <td><code>a+</code></td>
                        <td>Append & Read (text)</td>
                        <td>End</td>
                        <td>Yes</td>
                        <td>No</td>
                        <td>Read requires seek(0)</td>
                    </tr>
                    <tr>
                        <td><code>rb</code></td>
                        <td>Read (binary)</td>
                        <td>Beginning</td>
                        <td>No</td>
                        <td>No</td>
                        <td>For binary files</td>
                    </tr>
                    <tr>
                        <td><code>wb</code></td>
                        <td>Write (binary)</td>
                        <td>Beginning</td>
                        <td>Yes</td>
                        <td>Yes</td>
                        <td>For binary files</td>
                    </tr>
                    <tr>
                        <td><code>ab</code></td>
                        <td>Append (binary)</td>
                        <td>End</td>
                        <td>Yes</td>
                        <td>No</td>
                        <td>For binary files</td>
                    </tr>
                    <tr>
                        <td><code>rb+</code></td>
                        <td>Read & Write (binary)</td>
                        <td>Beginning</td>
                        <td>No</td>
                        <td>No</td>
                        <td>Binary + overwrite</td>
                    </tr>
                    <tr>
                        <td><code>wb+</code></td>
                        <td>Write & Read (binary)</td>
                        <td>Beginning</td>
                        <td>Yes</td>
                        <td>Yes</td>
                        <td>Binary + overwrite</td>
                    </tr>
                    <tr>
                        <td><code>ab+</code></td>
                        <td>Append & Read (binary)</td>
                        <td>End</td>
                        <td>Yes</td>
                        <td>No</td>
                        <td>Binary append</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Reading and Writing -->
        <section id="reading-writing" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-edit"></i>
                7. Reading from a File
            </h2>
            
            <div class="code-block">f = open("data.txt", "r")
data = f.read()       # Reads entire file
print(data)
f.close()</div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-list"></i>
                    Other reading methods:
                </h3>
                
                <ul class="feature-list">
                    <li><strong>f.readline():</strong> Reads one line at a time</li>
                    <li><strong>f.readlines():</strong> Returns list of all lines</li>
                </ul>
            </div>

            <h2 class="section-title" style="margin-top: 40px;">
                <i class="fas fa-pen"></i>
                8. Writing to a File
            </h2>
            
            <div class="code-block">f = open("data.txt", "w")
f.write("Hello, Python!\n")
f.close()</div>

            <div class="warning-box">
                <div class="box-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Warning
                </div>
                Overwrites existing file if it exists.
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-plus"></i>
                    To append:
                </h3>
                
                <div class="code-block">f = open("data.txt", "a")
f.write("New line.\n")
f.close()</div>
            </div>
        </section>

        <!-- Seek and Tell -->
        <section class="content-section">
            <h2 class="section-title">
                <i class="fas fa-crosshairs"></i>
                9. Seek & Tell
            </h2>
            
            <ul class="feature-list">
                <li><strong>tell():</strong> Get current file pointer position</li>
                <li><strong>seek(offset, whence):</strong> Move pointer to specific position</li>
            </ul>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-info-circle"></i>
                    Whence parameter values:
                </h3>
                
                <ul class="feature-list">
                    <li><strong>whence = 0:</strong> beginning (default)</li>
                    <li><strong>whence = 1:</strong> current position</li>
                    <li><strong>whence = 2:</strong> end of file</li>
                </ul>
            </div>

            <div class="code-block">f = open("data.txt", "r+")
print(f.tell())    # 0
f.seek(5)          # Move to 5th byte
print(f.tell())    # 5</div>
        </section>

        <!-- Binary Files -->
        <section id="binary-files" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-file-code"></i>
                10. Working with Binary Files
            </h2>
            
            <div class="code-block"># Copy an image
f1 = open("image1.jpg", "rb")
f2 = open("image_copy.jpg", "wb")

for chunk in f1:
    f2.write(chunk)

f1.close()
f2.close()</div>

            <div class="info-box">
                <div class="box-title">
                    <i class="fas fa-info-circle"></i>
                    Why Binary Mode?
                </div>
                Binary mode avoids encoding/decoding, so it's used for images, audio, etc.
            </div>
        </section>

        <!-- Context Managers -->
        <section id="context-managers" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-shield-alt"></i>
                11. Using with Statement (Context Managers)
            </h2>
            
            <div class="content-text">
                Automatic file closing (best practice):
            </div>

            <div class="code-block">with open("data.txt", "r") as f:
    data = f.read()
    print(data)
# File automatically closed here</div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-shield-alt"></i>
                    The Problem with Manual Closing
                </h3>
                
                <div class="content-text">
                    If you do manual closing and an error occurs before <code>f.close()</code> runs, the file stays open, which can:
                </div>

                <ul class="feature-list">
                    <li>Lock the file for other programs</li>
                    <li>Cause data corruption if writing</li>
                    <li>Waste system resources</li>
                </ul>

                <div class="code-block">f = open("data.txt", "r")
data = f.read()
1 / 0       # ‚ùå Exception before close()
f.close()   # Never runs</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-check-circle"></i>
                    The Solution: Context Managers
                </h3>
                
                <div class="content-text">
                    A context manager automatically handles opening and closing the file, even if errors occur.
                </div>

                <div class="code-block">with open("data.txt", "r") as f:
    data = f.read()
    print(data)
# File is automatically closed here</div>

                <div class="info-box">
                    <div class="box-title">
                        <i class="fas fa-info-circle"></i>
                        How it works
                    </div>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>When the with block starts ‚Üí calls f.__enter__()</li>
                        <li>When the block ends (even if an error occurs) ‚Üí calls f.__exit__() which closes the file</li>
                    </ul>
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-copy"></i>
                    Multiple Files in One with
                </h3>
                
                <div class="content-text">
                    You can manage more than one file at once:
                </div>

                <div class="code-block">with open("input.txt", "r") as fin, open("output.txt", "w") as fout:
    for line in fin:
        fout.write(line.upper())</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-star"></i>
                    Why It's Better
                </h3>
                
                <ul class="feature-list">
                    <li>‚úÖ No risk of forgetting close()</li>
                    <li>‚úÖ Works even with exceptions</li>
                    <li>‚úÖ Cleaner, shorter code</li>
                </ul>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-file-image"></i>
                    Combining with Binary Files
                </h3>
                
                <div class="content-text">
                    You can also use it for binary data:
                </div>

                <div class="code-block">with open("photo.jpg", "rb") as src, open("copy.jpg", "wb") as dest:
    for chunk in src:
        dest.write(chunk)</div>
            </div>
        </section>

        <!-- Random Access -->
        <section id="random-access" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-random"></i>
                12. Random File Access with seek() and tell()
            </h2>
            
            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-crosshairs"></i>
                    1. The File Pointer
                </h3>
                
                <div class="content-text">
                    Think of the file pointer as a cursor that shows where the next read or write will happen.
                </div>

                <div class="content-text">
                    When you open a file:
                </div>

                <ul class="feature-list">
                    <li><strong>In read mode:</strong> pointer starts at the beginning</li>
                    <li><strong>In append mode:</strong> pointer starts at the end</li>
                </ul>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-question-circle"></i>
                    2. tell() ‚Üí Where am I?
                </h3>
                
                <div class="content-text">
                    <code>tell()</code> returns the current byte position of the file pointer.
                </div>

                <div class="code-block">with open("sample.txt", "r") as f:
    print(f.tell())  # 0 ‚Äî start of file
    f.read(5)
    print(f.tell())  # 5 ‚Äî after reading 5 characters</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-arrows-alt"></i>
                    3. seek() ‚Üí Move the pointer
                </h3>
                
                <div class="content-text">
                    <code>seek(offset, whence)</code> moves the pointer to a new position.
                </div>

                <ul class="feature-list">
                    <li><strong>offset:</strong> number of bytes to move</li>
                    <li><strong>whence:</strong>
                        <ul style="margin-left: 20px; list-style-type: disc;">
                            <li>0 (default) ‚Üí from beginning of file</li>
                            <li>1 ‚Üí from current position</li>
                            <li>2 ‚Üí from end of file</li>
                        </ul>
                    </li>
                </ul>

                <div class="code-block">with open("sample.txt", "r") as f:
    f.seek(10)      # Move to 10th byte from start
    print(f.read(5))</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-edit"></i>
                    4. Editing a File in the Middle
                </h3>
                
                <div class="content-text">
                    Without seek(), writing always happens at start (w) or end (a).
                    With seek(), you can overwrite only specific parts:
                </div>

                <div class="code-block">with open("sample.txt", "r+") as f:
    f.seek(6)              # Move to 7th byte
    f.write("WORLD")       # Overwrite from that point</div>

                <div class="info-box">
                    <div class="box-title">
                        <i class="fas fa-info-circle"></i>
                        Example
                    </div>
                    If sample.txt contained: <code>HELLO PYTHON</code><br>
                    After running, it becomes: <code>HELLO WORLDON</code><br>
                    (We overwrote " PYTH" with "WORLD" ‚Äî careful, it doesn't insert!)
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-arrow-up"></i>
                    5. Jumping from the End
                </h3>
                
                <div class="content-text">
                    You can move relative to the file's end (whence=2):
                </div>

                <div class="code-block">with open("sample.txt", "rb+") as f:
    f.seek(-5, 2)          # Go 5 bytes before the end
    print(f.read().decode())</div>

                <div class="content-text">
                    Useful for:
                </div>

                <ul class="feature-list">
                    <li>Reading a file footer</li>
                    <li>Modifying only the last few bytes</li>
                </ul>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-forward"></i>
                    6. Skipping Bytes While Reading
                </h3>
                
                <div class="code-block">with open("sample.txt", "r") as f:
    while True:
        chunk = f.read(4)
        if not chunk:
            break
        print(chunk)
        f.seek(2, 1)   # Skip 2 bytes after reading each chunk</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-lightbulb"></i>
                    7. Practical Use Cases
                </h3>
                
                <ul class="feature-list">
                    <li><strong>Log file processing:</strong> jump to the last N lines without reading the whole file</li>
                    <li><strong>File repair:</strong> replace damaged sections only</li>
                    <li><strong>Custom file formats:</strong> skip headers/metadata and jump directly to data</li>
                    <li><strong>Resume downloads:</strong> start writing from where download stopped</li>
                </ul>
            </div>
        </section>

        <!-- Advanced Techniques -->
        <section id="advanced-techniques" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-rocket"></i>
                13. Efficient tail (last N lines) Reader
            </h2>
            
            <div class="content-text">
                Here's a practical, production-style tail reader that doesn't load the whole file. It jumps from the end and reads in chunks until it has enough newlines.
            </div>

            <div class="code-block">from typing import List

def tail(path: str, n: int = 10, chunk_size: int = 4096, encoding: str = "utf-8") -> List[str]:
    """
    Return the last n lines of a text file efficiently.
    Reads from the end in binary, accumulates just enough bytes, then decodes once.
    """
    if n <= 0:
        return []

    with open(path, "rb") as f:
        f.seek(0, 2)                 # go to end
        file_end = f.tell()
        pos = file_end
        buf = b""

        # keep pulling chunks from the end until we have n newlines (or we hit start)
        while pos > 0 and buf.count(b"\n") < n + 1:
            read_size = min(chunk_size, pos)
            pos -= read_size
            f.seek(pos)
            buf = f.read(read_size) + buf

        # split into lines (handles \n, \r\n, and files without trailing newline)
        # splitlines() keeps things robust across platforms
        lines = buf.splitlines()

        # Take the last n lines, decode bytes -> str (lossy replace if mixed encoding)
        last_n = lines[-n:] if n <= len(lines) else lines
        return [bline.decode(encoding, errors="replace") for bline in last_n]</div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-check-circle"></i>
                    Why this works well
                </h3>
                
                <ul class="feature-list">
                    <li><strong>O(k) read:</strong> where k ‚âà bytes covering the last n lines (not the whole file)</li>
                    <li><strong>Binary mode:</strong> avoids half-decoding multi-byte characters mid-chunk. Decodes at the end</li>
                    <li><strong>splitlines():</strong> handles \n and \r\n, and files that don't end with a newline</li>
                </ul>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-play"></i>
                    Example usage
                </h3>
                
                <div class="code-block">for line in tail("app.log", n=10):
    print(line)</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Common gotchas (and how the function avoids them)
                </h3>
                
                <ul class="feature-list">
                    <li><strong>Mixed/unknown encoding:</strong> we decode once with errors="replace" so it never crashes</li>
                    <li><strong>No trailing newline:</strong> splitlines() still returns the last line</li>
                    <li><strong>Very long lines:</strong> we keep growing the buffer until we see enough \n; if a single line is gigantic, increase chunk_size</li>
                </ul>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-star"></i>
                    Bonus: Tiny, simple fallback (OK for small files)
                </h3>
                
                <div class="content-text">
                    If the file isn't huge, this one-liner style is fine (but it reads the entire file):
                </div>

                <div class="code-block">from collections import deque

def tail_simple(path: str, n: int = 10, encoding: str = "utf-8"):
    with open(path, "r", encoding=encoding, errors="replace") as f:
        return list(deque(f, maxlen=n))</div>
            </div>
        </section>

        <!-- Common Pitfalls -->
        <section class="content-section">
            <h2 class="section-title">
                <i class="fas fa-exclamation-triangle"></i>
                12. Common Pitfalls
            </h2>
            
            <ul class="feature-list">
                <li><strong>Forgetting to close files:</strong> Memory leaks</li>
                <li><strong>Writing in w mode when you meant a:</strong> Data loss</li>
                <li><strong>Not using binary mode for non-text files:</strong> File corruption</li>
                <li><strong>Reading after writing in w+ without seek(0):</strong> No output</li>
            </ul>
        </section>

        <!-- Example Workflow -->
        <section class="content-section">
            <h2 class="section-title">
                <i class="fas fa-workflow"></i>
                13. Example Workflow
            </h2>
            
            <div class="code-block"># Create a file and write to it
with open("notes.txt", "w") as f:
    f.write("Line 1\n")
    f.write("Line 2\n")

# Append more data
with open("notes.txt", "a") as f:
    f.write("Line 3\n")

# Read all data
with open("notes.txt", "r") as f:
    for line in f:
        print(line.strip())</div>
        </section>

        <!-- Best Practices -->
        <section id="best-practices" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-star"></i>
                14. Extra Best Practices
            </h2>
            
            <ul class="feature-list">
                <li><strong>Always use with</strong> to avoid forgetting close()</li>
                <li><strong>Use os.path.exists()</strong> before opening in r mode</li>
                <li><strong>For large files,</strong> read in chunks (read(1024)) to save memory</li>
                <li><strong>When handling CSVs,</strong> use Python's csv module</li>
                <li><strong>Always specify encoding="utf-8"</strong> for text files</li>
                <li><strong>Use binary mode</strong> for non-text files</li>
                <li><strong>Stream with chunks,</strong> don't read() entire huge files</li>
            </ul>
        </section>

        <!-- Enhanced Guide -->
        <section class="content-section">
            <h2 class="section-title">
                <i class="fas fa-book"></i>
                File Handling in Python ‚Äî Enhanced Guide Summary
            </h2>
            
            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-question-circle"></i>
                    1) Why file handling?
                </h3>
                
                <ul class="feature-list">
                    <li><strong>Persistence:</strong> Keep data after program exits (disk vs RAM)</li>
                    <li><strong>Scale:</strong> Input/output large datasets without typing into the console</li>
                    <li><strong>Efficiency:</strong> Read only what you need, when you need it</li>
                </ul>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-file"></i>
                    2) Files 101
                </h3>
                
                <ul class="feature-list">
                    <li><strong>Text files (human-readable):</strong> .txt, .csv, .json, .py</li>
                    <li><strong>Binary files (not human-readable):</strong> .jpg, .png, .mp3, .zip, .exe</li>
                </ul>

                <div class="content-text">
                    A file is a named location on disk. Your program uses a file object (a "pointer/handler") to read/write.
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-cog"></i>
                    3) Opening files & modes
                </h3>
                
                <div class="code-block">f = open(filename, mode)</div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">Text modes</h4>
                <ul class="feature-list">
                    <li><strong>r:</strong> read (error if missing)</li>
                    <li><strong>w:</strong> write (create or overwrite)</li>
                    <li><strong>a:</strong> append (create or write at end)</li>
                    <li><strong>r+:</strong> read & write (no create, no auto-erase)</li>
                    <li><strong>w+:</strong> write & read (create or overwrite)</li>
                    <li><strong>a+:</strong> append & read (create, pointer starts at end)</li>
                </ul>

                <div class="info-box">
                    <div class="box-title">
                        <i class="fas fa-info-circle"></i>
                        Binary variants
                    </div>
                    Add 'b' ‚Üí rb, wb, ab, rb+, wb+, ab+
                </div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">Where's the pointer?</h4>
                <ul class="feature-list">
                    <li><strong>r, r+, w, w+:</strong> start</li>
                    <li><strong>a, a+:</strong> end</li>
                </ul>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-shield-alt"></i>
                    4) Always: context managers
                </h3>
                
                <div class="content-text">
                    Manual close() can be skipped accidentally (e.g., exceptions). Use with:
                </div>

                <div class="code-block">with open("data.txt", "r", encoding="utf-8") as f:
    text = f.read()</div>

                <div class="content-text">
                    Multiple files:
                </div>

                <div class="code-block">with open("in.txt") as fin, open("out.txt", "w") as fout:
    for line in fin:
        fout.write(line.upper())</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-edit"></i>
                    5) Reading & writing (text)
                </h3>
                
                <div class="code-block"># Write (overwrite)
with open("notes.txt", "w", encoding="utf-8") as f:
    f.write("Line 1\n")
    f.write("Line 2\n")

# Append
with open("notes.txt", "a", encoding="utf-8") as f:
    f.write("Line 3\n")

# Read
with open("notes.txt", "r", encoding="utf-8") as f:
    print(f.read())          # all
    # f.readline()            # one line
    # f.readlines()           # list of lines
    # iterate: for line in f: ...</div>

                <div class="warning-box">
                    <div class="box-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        Important
                    </div>
                    In w+ and a+, if you write then want to read, call f.seek(0) first.
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-random"></i>
                    6) Random access: seek() and tell()
                </h3>
                
                <div class="code-block">with open("sample.txt", "r+") as f:
    print(f.tell())      # 0
    f.seek(6)            # move to byte 6
    f.write("WORLD")     # overwrite in place (does not insert)</div>

                <div class="content-text">
                    <code>seek(offset, whence)</code>
                </div>

                <ul class="feature-list">
                    <li><strong>whence=0:</strong> start (default), 1 current, 2 end</li>
                </ul>

                <div class="content-text">
                    Binary tailing example:
                </div>

                <div class="code-block">with open("sample.txt", "rb") as f:
    f.seek(-10, 2)   # 10 bytes before end
    tail_bytes = f.read()</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-file-code"></i>
                    7) Binary files (images, etc.)
                </h3>
                
                <div class="code-block"># Copy an image safely
with open("img.jpg", "rb") as src, open("img_copy.jpg", "wb") as dst:
    for chunk in iter(lambda: src.read(8192), b""):
        dst.write(chunk)</div>

                <div class="info-box">
                    <div class="box-title">
                        <i class="fas fa-info-circle"></i>
                        Why binary?
                    </div>
                    Avoids encoding/decoding; preserves exact bytes.
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-folder"></i>
                    8) Robust paths & existence
                </h3>
                
                <div class="code-block">from pathlib import Path

p = Path("data") / "input.txt"
if p.exists():
    with p.open("r", encoding="utf-8") as f:
        print(f.readline())</div>

                <div class="content-text">
                    Use absolute paths for files outside your working directory.
                </div>
            </div>
        </section>

        <!-- Student Location Update System -->
        <section id="student-location-system" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-user-graduate"></i>
                Student Location Update System
            </h2>
            
            <div class="content-text">
                This section demonstrates two approaches to updating student location data based on Student ID ranges - an enhanced robust solution and a simpler normal solution. Both examples showcase practical file handling techniques.
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-rocket"></i>
                    Enhanced Solution (Safer, More Robust)
                </h3>
                
                <div class="content-text">
                    This enhanced version includes header discovery, better error handling, batch processing, and simulation mode:
                </div>

                <div class="code-block"># ENHANCED SOLUTION (safer, more robust; still txt-only and beginner-friendly)
# Enhancements:
# - Header discovery: finds StudentID and Location by name (no hard-coded index)
# - Treats blank or 'NA' (case-insensitive) as missing
# - Writes to a clean output file (does not overwrite the input during processing)
# - Optional overwrite mode
# - Optional dry-run (simulate) mode
# - Clear summary of updates vs unchanged rows
# - Batch mode to update multiple IDs in one pass
# - Optional simple mapping override via string (e.g., "1:Mangalore,2:Kolkata,3:Chennai,4:Mumbai,5:NA")

LOCATION_MAP_DEFAULT = {1: "Mangalore", 2: "Kolkata", 3: "Chennai", 4: "Mumbai", 5: "NA"}


def check_studentid(p_sid):
    if 81 <= p_sid <= 85:
        return 1
    elif 86 <= p_sid <= 90:
        return 2
    elif 91 <= p_sid <= 95:
        return 3
    elif 96 <= p_sid <= 100:
        return 4
    else:
        return 5


def _normalize_header(name):
    return name.strip().lower().replace(" ", "").replace("_", "")


def parse_mapping_str(mapping_str):
    """
    Parse a simple mapping string like:
        "1:Mangalore,2:Kolkata,3:Chennai,4:Mumbai,5:NA"
    Returns a dict {1:..., 2:..., ...}. If None/empty, returns None.
    """
    if not mapping_str:
        return None
    result = {}
    for pair in mapping_str.split(","):
        if ":" not in pair:
            continue
        k, v = pair.split(":", 1)
        k = k.strip()
        v = v.strip()
        if not k:
            continue
        try:
            result[int(k)] = v
        except ValueError:
            raise ValueError("Mapping keys must be integers (1..5)")
    return result or None


def update_location_enhanced(
    p_sid,
    in_file="StudentData5.txt",
    out_file="StudentData5_clean.txt",
    overwrite=False,
    simulate=False,
    mapping_override=None,  # string like "1:Mangalore,2:Kolkata,3:Chennai,4:Mumbai,5:NA"
):
    # Choose mapping
    custom_map = parse_mapping_str(mapping_override)
    LOCATION_MAP = custom_map if custom_map else LOCATION_MAP_DEFAULT

    # Read all lines
    with open(in_file, "r", encoding="utf-8") as f:
        lines = f.read().splitlines()
    if not lines:
        print("Empty file"); return

    # Header discovery
    headers = [h.strip() for h in lines[0].split(",")]
    norm2real = {_normalize_header(h): h for h in headers}
    if "studentid" not in norm2real or "location" not in norm2real:
        print("Header must contain 'StudentID' and 'Location'"); return

    sid_idx = headers.index(norm2real["studentid"])
    loc_idx = headers.index(norm2real["location"])

    # Process rows
    out_lines = [",".join(headers)]
    found = False
    updated = 0
    unchanged = 0
    invalid = 0

    for raw in lines[1:]:
        parts = [p.strip() for p in raw.split(",")]
        if len(parts) < len(headers):
            parts += [""] * (len(headers) - len(parts))

        # Skip non-integer IDs safely
        try:
            sid_val = int(parts[sid_idx])
        except ValueError:
            invalid += 1
            out_lines.append(",".join(parts))
            continue

        if sid_val == p_sid:
            found = True
            current = parts[loc_idx].strip()
            is_missing = (current == "" or current.lower() == "na")

            if overwrite or is_missing:
                target_loc = LOCATION_MAP.get(check_studentid(p_sid), "NA")
                if current != target_loc:
                    parts[loc_idx] = target_loc
                    updated += 1
                    print(f"[CHANGE] {p_sid}: '{current or '(blank)'}' -> '{target_loc}'")
                else:
                    unchanged += 1
                    print("Change not required for Location")
            else:
                unchanged += 1
                print("Change not required for Location")

        out_lines.append(",".join(parts))

    # Write output
    if simulate:
        print("\n[SIMULATION] No file written.")
    else:
        with open(out_file, "w", encoding="utf-8") as f:
            f.write("\n".join(out_lines))
        print(f"\nWrote updates to: {out_file}")

    if not found:
        print(f"Student with ID {p_sid} not found")

    print(f"Summary: updated={updated}, unchanged={unchanged}, invalid_rows={invalid}")


# ---- Batch helper (optional) ----

def update_locations_batch(psids, **kwargs):
    for sid in psids:
        update_location_enhanced(sid, **kwargs)</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-code"></i>
                    Normal Solution (Simple Approach)
                </h3>
                
                <div class="content-text">
                    This is the simpler, more straightforward implementation:
                </div>

                <div class="code-block">def check_studentid(p_sid):
    if(p_sid>=81 and p_sid<=85):
        return 1
    elif(p_sid>=86 and p_sid<=90):
        return 2
    elif(p_sid>=91 and p_sid<=95):
        return 3
    elif(p_sid>=96 and p_sid<=100):
        return 4
    else:
        return 5

def update_location(p_sid):
    # Location mapping based on check_studentid return values
    location_mapping = {
        1: "Mangalore",
        2: "Kolkata", 
        3: "Chennai",
        4: "Mumbai",
        5: "NA"
    }
    
    # Read the text file
    lines = []
    with open('StudentData5.txt', 'r') as file:
        lines = file.readlines()
    
    # Find the student with the given ID
    student_found = False
    for i, line in enumerate(lines):
        if i == 0:  # Skip header line
            continue
            
        # Split the line by comma to get individual fields
        fields = line.strip().split(',')
        if len(fields) >= 15:  # Ensure we have all fields including Location
            student_id = int(fields[0])
            
            if student_id == p_sid:
                student_found = True
                location = fields[14]  # Location is the 15th field (index 14)
                
                # Check if location is present (not empty)
                if location.strip() == '':
                    # Location is not present, need to update
                    result = check_studentid(p_sid)
                    new_location = location_mapping[result]
                    
                    # Update the location in the line
                    fields[14] = new_location
                    lines[i] = ','.join(fields) + '\n'
                    
                    # Write back to file
                    with open('StudentData5.txt', 'w') as file:
                        file.writelines(lines)
                    
                    print(f"Location for {p_sid} updated as {new_location} successfully")
                else:
                    # Location is already present
                    print("Change not required for Location")
                break
    
    if not student_found:
        print(f"Student with ID {p_sid} not found")

# Example usage:
# update_location(82)  # This will update location for student ID 82 if not present
# update_location(81)  # This will show "Change not required" since location already exists</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-play"></i>
                    How to Run the Enhanced Solution
                </h3>
                
                <div class="content-text">
                    Here are copy-paste examples for running the enhanced solution:
                </div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">Preview Only (No File Write):</h4>
                <div class="code-block">python -c "from enhanced_solution import update_location_enhanced as u; u(90, simulate=True)"
python -c "from enhanced_solution import update_location_enhanced as u; u(90, simulate=True, overwrite=True)"</div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">Write to Clean File (StudentData5_clean.txt):</h4>
                <div class="code-block">python -c "from enhanced_solution import update_location_enhanced as u; u(90)"
python -c "from enhanced_solution import update_location_enhanced as u; u(90, overwrite=True)"</div>
            </div>

            <div class="info-box">
                <div class="box-title">
                    <i class="fas fa-info-circle"></i>
                    Key Features of Enhanced Solution
                </div>
                <ul class="feature-list">
                    <li><strong>Header Discovery:</strong> Automatically finds StudentID and Location columns by name</li>
                    <li><strong>Safe Processing:</strong> Writes to a separate output file, preserving original data</li>
                    <li><strong>Simulation Mode:</strong> Test changes without writing files</li>
                    <li><strong>Batch Processing:</strong> Update multiple student IDs at once</li>
                    <li><strong>Comprehensive Logging:</strong> Detailed summary of all operations</li>
                    <li><strong>Error Handling:</strong> Gracefully handles malformed data</li>
                </ul>
            </div>

            <div class="info-box">
                <div class="box-title">
                    <i class="fas fa-map-marker-alt"></i>
                    Location Mapping Rules
                </div>
                <ul class="feature-list">
                    <li><strong>Student ID 81-85:</strong> Mangalore</li>
                    <li><strong>Student ID 86-90:</strong> Kolkata</li>
                    <li><strong>Student ID 91-95:</strong> Chennai</li>
                    <li><strong>Student ID 96-100:</strong> Mumbai</li>
                    <li><strong>All Other IDs:</strong> NA</li>
                </ul>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-shield-alt"></i>
                    Enhanced Solution 3 (Maximum Robustness)
                </h3>
                
                <div class="content-text">
                    This version adds comprehensive input validation, better error handling, and type conversion capabilities:
                </div>

                <div class="code-block"># ENHANCED SOLUTION 3 (safer, more robust; still txt-only and beginner-friendly)
# Enhancements:
# - Header discovery: finds StudentID and Location by name (no hard-coded index)
# - Treats blank or 'NA' (case-insensitive) as missing
# - Writes to a clean output file (does not overwrite the input during processing)
# - Optional overwrite mode
# - Optional dry-run (simulate) mode
# - Clear summary of updates vs unchanged rows
# - Batch mode to update multiple IDs in one pass
# - Optional simple mapping override via string (e.g., "1:Mangalore,2:Kolkata,3:Chennai,4:Mumbai,5:NA")
# - Comprehensive input validation and error handling
# - Automatic type conversion for p_sid parameter

LOCATION_MAP_DEFAULT = {1: "Mangalore", 2: "Kolkata", 3: "Chennai", 4: "Mumbai", 5: "NA"}


def check_studentid(p_sid):
    if 81 <= p_sid <= 85:
        return 1
    elif 86 <= p_sid <= 90:
        return 2
    elif 91 <= p_sid <= 95:
        return 3
    elif 96 <= p_sid <= 100:
        return 4
    else:
        return 5


def _normalize_header(name):
    return name.strip().lower().replace(" ", "").replace("_", "")


def parse_mapping_str(mapping_str):
    """
    Parse a simple mapping string like:
        "1:Mangalore,2:Kolkata,3:Chennai,4:Mumbai,5:NA"
    Returns a dict {1:..., 2:..., ...}. If None/empty, returns None.
    """
    if not mapping_str:
        return None
    result = {}
    for pair in mapping_str.split(","):
        if ":" not in pair:
            continue
        k, v = pair.split(":", 1)
        k = k.strip()
        v = v.strip()
        if not k:
            continue
        try:
            result[int(k)] = v
        except ValueError:
            raise ValueError("Mapping keys must be integers (1..5)")
    return result or None


def update_location_enhanced(
    p_sid,
    in_file="StudentData5.txt",
    out_file="StudentData5_clean.txt",
    overwrite=False,
    simulate=False,
    mapping_override=None,  # string like "1:Mangalore,2:Kolkata,3:Chennai,4:Mumbai,5:NA"
):
    # Input validation for p_sid
    if not isinstance(p_sid, int):
        try:
            p_sid = int(p_sid)
        except (ValueError, TypeError):
            print(f"Error: p_sid must be an integer, got {type(p_sid).__name__}: {p_sid}")
            return
    
    if p_sid < 0:
        print(f"Error: p_sid must be positive, got {p_sid}")
        return
    
    # Choose mapping
    custom_map = parse_mapping_str(mapping_override)
    LOCATION_MAP = custom_map if custom_map else LOCATION_MAP_DEFAULT

    # File existence check with proper error handling
    try:
        with open(in_file, "r", encoding="utf-8") as f:
            lines = f.read().splitlines()
    except FileNotFoundError:
        print(f"Error: Input file '{in_file}' not found")
        return
    except PermissionError:
        print(f"Error: Permission denied to read '{in_file}'")
        return
    except Exception as e:
        print(f"Error reading file '{in_file}': {e}")
        return
    
    if not lines:
        print("Error: Empty file"); return

    # Header discovery
    headers = [h.strip() for h in lines[0].split(",")]
    norm2real = {_normalize_header(h): h for h in headers}
    if "studentid" not in norm2real or "location" not in norm2real:
        print("Header must contain 'StudentID' and 'Location'"); return

    sid_idx = headers.index(norm2real["studentid"])
    loc_idx = headers.index(norm2real["location"])

    # Process rows
    out_lines = [",".join(headers)]
    found = False
    updated = 0
    unchanged = 0
    invalid = 0

    for raw in lines[1:]:
        parts = [p.strip() for p in raw.split(",")]
        if len(parts) < len(headers):
            parts += [""] * (len(headers) - len(parts))

        # Skip non-integer IDs safely
        try:
            sid_val = int(parts[sid_idx])
        except ValueError:
            invalid += 1
            out_lines.append(",".join(parts))
            continue

        if sid_val == p_sid:
            found = True
            current = parts[loc_idx].strip()
            is_missing = (current == "" or current.lower() == "na")

            if overwrite or is_missing:
                target_loc = LOCATION_MAP.get(check_studentid(p_sid), "NA")
                if current != target_loc:
                    parts[loc_idx] = target_loc
                    updated += 1
                    print(f"[CHANGE] {p_sid}: '{current or '(blank)'}' -> '{target_loc}'")
                else:
                    unchanged += 1
                    print("Change not required for Location")
            else:
                unchanged += 1
                print("Change not required for Location")

        out_lines.append(",".join(parts))

    # Write output
    if simulate:
        print("\n[SIMULATION] No file written.")
    else:
        try:
            with open(out_file, "w", encoding="utf-8") as f:
                f.write("\n".join(out_lines))
            print(f"\nWrote updates to: {out_file}")
        except PermissionError:
            print(f"Error: Permission denied to write '{out_file}'")
            return
        except Exception as e:
            print(f"Error writing file '{out_file}': {e}")
            return

    if not found:
        print(f"Student with ID {p_sid} not found")

    print(f"Summary: updated={updated}, unchanged={unchanged}, invalid_rows={invalid}")


# ---- Batch helper (optional) ----

def update_locations_batch(psids, **kwargs):
    for sid in psids:
        update_location_enhanced(sid, **kwargs)</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-vial"></i>
                    Testing Enhanced Solution 3
                </h3>
                
                <div class="content-text">
                    Here are comprehensive test cases to validate the enhanced error handling:
                </div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">Test Invalid Inputs:</h4>
                <div class="code-block">python -c "from enhanced_solution import *; print('Test 1: Invalid p_sid (string):'); update_location_enhanced('abc'); print('\nTest 2: Negative p_sid:'); update_location_enhanced(-5); print('\nTest 3: Non-existent file:'); update_location_enhanced(82, in_file='nonexistent.txt'); print('\nTest 4: Valid case with simulation:'); update_location_enhanced(85, simulate=True)"</div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">Test Type Conversion:</h4>
                <div class="code-block">python -c "from enhanced_solution import *; print('Test: String number that can be converted:'); update_location_enhanced('86', simulate=True)"</div>
            </div>

            <div class="warning-box">
                <div class="box-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    New Error Handling Features in Enhanced Solution 3
                </div>
                <ul style="margin: 0; padding-left: 20px;">
                    <li><strong>Input Validation:</strong> Validates p_sid parameter type and value</li>
                    <li><strong>Type Conversion:</strong> Automatically converts string numbers to integers</li>
                    <li><strong>File Error Handling:</strong> Catches FileNotFoundError, PermissionError, and other exceptions</li>
                    <li><strong>Comprehensive Error Messages:</strong> Clear, descriptive error messages for debugging</li>
                    <li><strong>Graceful Failure:</strong> Functions return safely on errors without crashing</li>
                </ul>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-lightbulb"></i>
                    Key File Handling Concepts Demonstrated
                </h3>
                
                <ul class="feature-list">
                    <li><strong>Context Managers:</strong> Using <code>with open()</code> for safe file handling</li>
                    <li><strong>File Modes:</strong> Reading with 'r' and writing with 'w' modes</li>
                    <li><strong>Text Processing:</strong> Splitting CSV data and manipulating strings</li>
                    <li><strong>Error Handling:</strong> Graceful handling of file and data errors</li>
                    <li><strong>Data Validation:</strong> Checking for valid data before processing</li>
                    <li><strong>Backup Strategy:</strong> Creating clean output files instead of overwriting originals</li>
                    <li><strong>Exception Handling:</strong> Try-catch blocks for robust error management</li>
                    <li><strong>Type Checking:</strong> Runtime validation and conversion of input parameters</li>
                </ul>
            </div>
        </section>

        <!-- Unix Part -->
        <section id="unix-part" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-terminal"></i>
                Unix Part - Bash Scripts for Data Processing
            </h2>
            
            <div class="content-text">
                This section demonstrates how to process student data using Unix/Bash scripts. These scripts show file processing, data manipulation, and statistical calculations using shell scripting.
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-edit"></i>
                    Script 1: Data Correction and Cleaning
                </h3>
                
                <div class="content-text">
                    This script corrects date formats and fills missing location data:
                </div>

                <div class="code-block">#!/usr/bin/env bash
set -u

INPUT="${1:-StudentData2.txt}"
OUTPUT="${2:-ModifiedData.txt}"

echo "[Q1] Writing corrected file to: $OUTPUT"

first=1
: > "$OUTPUT"  # truncate

while IFS="," read -r id age dob gender socio school grade att gpa disc act parent grad drop loc
do
  if [ $first -eq 1 ]; then
    echo "$id,$age,$dob,$gender,$socio,$school,$grade,$att,$gpa,$disc,$act,$parent,$grad,$drop,$loc" >> "$OUTPUT"
    first=0
    continue
  fi

  # normalize delimiter in DOB to '-'
  dob="${dob//\//-}"

  # split date
  dd=""; mm=""; yy=""
  IFS="-" read -r dd mm yy <<< "$dob"

  # if year has 2 digits, prefix '20'
  if [ -n "${yy:-}" ] && [ "${#yy}" -eq 2 ]; then
    yy="20${yy}"
  fi
  if [ -n "$dd" ] && [ -n "$mm" ] && [ -n "$yy" ]; then
    dob_fixed="${dd}-${mm}-${yy}"
  else
    dob_fixed="$dob"
  fi

  # fill missing location
  if [ -z "${loc:-}" ]; then
    loc="Delhi"
  fi

  echo "$id,$age,$dob_fixed,$gender,$socio,$school,$grade,$att,$gpa,$disc,$act,$parent,$grad,$drop,$loc" >> "$OUTPUT"
done < "$INPUT"

echo "Done."</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-chart-bar"></i>
                    Script 2: Average Discipline by Parental Care
                </h3>
                
                <div class="content-text">
                    Calculate average discipline incidents grouped by parental care level:
                </div>

                <div class="code-block">#!/usr/bin/env bash
set -u

INPUT="${1:-ModifiedData.txt}"

declare -A SUM
declare -A CNT

# integer average (use bc for decimal if needed)
while IFS="," read -r id age dob gender socio school grade att gpa disc act parent grad drop loc
do
  [ "$id" = "StudentID" ] && continue
  SUM["$parent"]=$(( ${SUM["$parent"]:-0} + ${disc:-0} ))
  CNT["$parent"]=$(( ${CNT["$parent"]:-0} + 1 ))
done < "$INPUT"

# print sorted by parental care
for k in "${!CNT[@]}"; do
  # decimal average:
  avg=$(echo "scale=2; ${SUM[$k]} / ${CNT[$k]}" | bc)
  printf "%s -> Average Discipline = %s\n" "$k" "$avg"
done | sort</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-school"></i>
                    Script 3: Total Incidents by School
                </h3>
                
                <div class="content-text">
                    Calculate total discipline incidents for each school:
                </div>

                <div class="code-block">#!/usr/bin/env bash
set -u

INPUT="${1:-ModifiedData.txt}"

declare -A TOTAL

while IFS="," read -r id age dob gender socio school grade att gpa disc act parent grad drop loc
do
  [ "$id" = "StudentID" ] && continue
  TOTAL["$school"]=$(( ${TOTAL["$school"]:-0} + ${disc:-0} ))
done < "$INPUT"

for k in "${!TOTAL[@]}"; do
  printf "%s -> Total Incidents = %s\n" "$k" "${TOTAL[$k]}"
done | sort</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-graduation-cap"></i>
                    Script 4: Average GPA by Socio-Economic Status and Parental Care
                </h3>
                
                <div class="content-text">
                    Calculate average GPA grouped by socio-economic status and parental care combination:
                </div>

                <div class="code-block">#!/usr/bin/env bash
set -u

INPUT="${1:-ModifiedData.txt}"

declare -A SUM
declare -A CNT

while IFS="," read -r id age dob gender socio school grade att gpa disc act parent grad drop loc
do
  [ "$id" = "StudentID" ] && continue
  key="${socio}-${parent}"
  SUM["$key"]=$(echo "${SUM["$key"]:-0} + ${gpa:-0}" | bc)
  CNT["$key"]=$(( ${CNT["$key"]:-0} + 1 ))
done < "$INPUT"

for k in "${!CNT[@]}"; do
  avg=$(echo "scale=4; ${SUM[$k]} / ${CNT[$k]}" | bc)
  printf "%s -> Avg GPA = %s\n" "$k" "$avg"
done | sort</div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-map-marker-alt"></i>
                    Script 5: Dropout Rate by Location
                </h3>
                
                <div class="content-text">
                    Calculate dropout rates for each location with detailed statistics:
                </div>

                <div class="code-block">#!/usr/bin/env bash
set -u

INPUT="${1:-ModifiedData.txt}"

declare -A TOTAL
declare -A DROPS

while IFS="," read -r id age dob gender socio school grade att gpa disc act parent grad drop loc
do
  [ "$id" = "StudentID" ] && continue
  TOTAL["$loc"]=$(( ${TOTAL["$loc"]:-0} + 1 ))
  DROPS["$loc"]=$(( ${DROPS["$loc"]:-0} + ${drop:-0} ))
done < "$INPUT"

for k in "${!TOTAL[@]}"; do
  rate=$(echo "scale=2; (${DROPS[$k]} / ${TOTAL[$k]}) * 100" | bc)
  printf "%s -> Dropout Rate = %s%%  (dropped=%s / total=%s)\n" "$k" "$rate" "${DROPS[$k]}" "${TOTAL[$k]}"
done | sort</div>
            </div>

            <div class="info-box">
                <div class="box-title">
                    <i class="fas fa-info-circle"></i>
                    Key Bash Scripting Concepts Demonstrated
                </div>
                <ul class="feature-list">
                    <li><strong>File Reading:</strong> Using <code>while read</code> loops to process CSV files line by line</li>
                    <li><strong>Associative Arrays:</strong> Using <code>declare -A</code> for key-value data storage</li>
                    <li><strong>String Manipulation:</strong> Pattern replacement with <code>${var//pattern/replacement}</code></li>
                    <li><strong>Mathematical Operations:</strong> Using <code>bc</code> for decimal calculations</li>
                    <li><strong>Parameter Expansion:</strong> Default values with <code>${var:-default}</code></li>
                    <li><strong>Field Separation:</strong> Using <code>IFS</code> to split CSV fields</li>
                    <li><strong>Conditional Logic:</strong> Testing string lengths and values</li>
                    <li><strong>Output Formatting:</strong> Using <code>printf</code> for formatted output</li>
                </ul>
            </div>

            <div class="warning-box">
                <div class="box-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Usage Instructions
                </div>
                <div class="content-text">
                    To run these scripts:
                </div>
                <ol style="margin: 10px 0; padding-left: 20px;">
                    <li>Save each script to a file (e.g., <code>script1.sh</code>, <code>script2.sh</code>, etc.)</li>
                    <li>Make them executable: <code>chmod +x script1.sh</code></li>
                    <li>Run with: <code>./script1.sh [input_file] [output_file]</code></li>
                    <li>For scripts 2-5: <code>./script2.sh [input_file]</code></li>
                </ol>
                <div class="content-text">
                    <strong>Note:</strong> Ensure you have <code>bc</code> calculator installed for decimal arithmetic.
                </div>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-cogs"></i>
                    Script Workflow
                </h3>
                
                <div class="content-text">
                    These scripts work together in sequence:
                </div>
                
                <ol style="margin: 10px 0; padding-left: 20px; line-height: 1.8;">
                    <li><strong>Script 1:</strong> Cleans and corrects the raw data (fixes dates, fills missing locations)</li>
                    <li><strong>Script 2:</strong> Analyzes discipline patterns by parental care level</li>
                    <li><strong>Script 3:</strong> Summarizes discipline incidents by school</li>
                    <li><strong>Script 4:</strong> Examines academic performance by socio-economic factors</li>
                    <li><strong>Script 5:</strong> Calculates dropout rates by geographic location</li>
                </ol>
            </div>

            <div class="subsection">
                <h3 class="subsection-title">
                    <i class="fas fa-sync-alt"></i>
                    Advanced Unix: Incremental Data Processing System
                </h3>
                
                <div class="content-text">
                    This advanced system demonstrates incremental data processing using bookmarks and state management. Instead of reprocessing the entire file each time, it only processes new rows that have been added since the last run.
                </div>

                <div class="info-box">
                    <div class="box-title">
                        <i class="fas fa-info-circle"></i>
                        System Components
                    </div>
                    <ul class="feature-list">
                        <li><strong>inc_setup.sh:</strong> Initialize state (bookmark + totals file)</li>
                        <li><strong>inc_q3_update.sh:</strong> Process only new rows since last run and update totals</li>
                        <li><strong>inc_q3_show.sh:</strong> Pretty print the current totals (sorted)</li>
                        <li><strong>inc_q3_reset.sh:</strong> Reset everything safely</li>
                        <li><strong>inc_q3_recompute_full.sh:</strong> Recompute from scratch if file changed drastically</li>
                    </ul>
                </div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">1) inc_setup.sh ‚Äî Initialize System (Run Once)</h4>
                <div class="content-text">
                    Initializes the checkpoint and an empty totals file:
                </div>

                <div class="code-block">#!/usr/bin/env bash
set -u

INPUT="${1:-ModifiedData.txt}"
STATE_DIR="state"
LAST_FILE="$STATE_DIR/last_line.txt"
TOT_FILE="$STATE_DIR/q3_totals.csv"

mkdir -p "$STATE_DIR"

# Start with header counted as processed (line 1)
echo "1" > "$LAST_FILE"

# Initialize the persisted totals CSV if missing
if [ ! -f "$TOT_FILE" ]; then
  echo "SchoolType,TotalIncidents" > "$TOT_FILE"
fi

echo "Initialized:"
echo "  - Bookmark: $LAST_FILE (set to line 1)"
echo "  - Totals:   $TOT_FILE"</div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">2) inc_q3_update.sh ‚Äî Process New Data (Run When Data Grows)</h4>
                <div class="content-text">
                    Reads only new lines appended to ModifiedData.txt, updates totals per SchoolType, then advances the bookmark:
                </div>

                <div class="code-block">#!/usr/bin/env bash
set -u

INPUT="${1:-ModifiedData.txt}"
STATE_DIR="state"
LAST_FILE="$STATE_DIR/last_line.txt"
TOT_FILE="$STATE_DIR/q3_totals.csv"

# Safety checks
[ -f "$INPUT" ]     || { echo "ERROR: $INPUT not found"; exit 2; }
[ -f "$LAST_FILE" ] || { echo "ERROR: $LAST_FILE not found (run ./inc_setup.sh)"; exit 2; }
[ -f "$TOT_FILE" ]  || { echo "ERROR: $TOT_FILE not found (run ./inc_setup.sh)"; exit 2; }

# Get current bookmark and file line count
last_line=$(cat "$LAST_FILE")
total_lines=$(wc -l < "$INPUT")

# If the file shrank or header missing, ask to reset
if [ "$total_lines" -lt 1 ]; then
  echo "ERROR: $INPUT seems empty or invalid."
  exit 2
fi
if [ "$total_lines" -lt "$last_line" ]; then
  echo "Detected file shrink/replace (total=$total_lines < last=$last_line)."
  echo "Run ./inc_q3_reset.sh (or ./inc_q3_recompute_full.sh) to recover."
  exit 3
fi

# No new rows? Nothing to do.
if [ "$total_lines" -le "$last_line" ]; then
  echo "No new rows. (bookmark=$last_line, total=$total_lines)"
  exit 0
fi

echo "New rows to process: $(( total_lines - last_line ))"

# Load existing totals into an associative array
declare -A TOTAL
first=1
while IFS="," read -r stype total
do
  if [ $first -eq 1 ]; then first=0; continue; fi  # skip header in totals file
  TOTAL["$stype"]="${total:-0}"
done < "$TOT_FILE"

# Process only the delta (skip already processed lines; header is line 1)
tail -n +"$((last_line+1))" "$INPUT" | \
while IFS="," read -r id age dob gender socio school grade att gpa disc act parent grad drop loc
do
  # Defensive defaults
  school="${school:-Unknown}"
  disc="${disc:-0}"

  # Update running total per SchoolType (integer sum)
  TOTAL["$school"]=$(( ${TOTAL["$school"]:-0} + disc ))
done

# Persist updated totals (sorted by SchoolType for readability)
{
  echo "SchoolType,TotalIncidents"
  for k in "${!TOTAL[@]}"; do
    printf "%s,%s\n" "$k" "${TOTAL[$k]}"
  done | sort
} > "$TOT_FILE"

# Move bookmark to end of file
echo "$total_lines" > "$LAST_FILE"

echo "Updated:"
echo "  - $TOT_FILE (totals refreshed)"
echo "  - $LAST_FILE (bookmark -> line $total_lines)"</div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">3) inc_q3_show.sh ‚Äî Display Results</h4>
                <div class="content-text">
                    Shows the current totals sorted:
                </div>

                <div class="code-block">#!/usr/bin/env bash
set -u

TOT_FILE="${1:-state/q3_totals.csv}"
[ -f "$TOT_FILE" ] || { echo "ERROR: $TOT_FILE not found"; exit 2; }

echo "== Q3: Total Discipline Incidents by SchoolType =="
tail -n +2 "$TOT_FILE" | sort | while IFS="," read -r stype total
do
  printf "%-10s -> %s\n" "$stype" "$total"
done</div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">4) inc_q3_reset.sh ‚Äî Safe Reset</h4>
                <div class="content-text">
                    Resets bookmark and clears totals (keeps header):
                </div>

                <div class="code-block">#!/usr/bin/env bash
set -u

STATE_DIR="state"
LAST_FILE="$STATE_DIR/last_line.txt"
TOT_FILE="$STATE_DIR/q3_totals.csv"

mkdir -p "$STATE_DIR"
echo "1" > "$LAST_FILE"
echo "SchoolType,TotalIncidents" > "$TOT_FILE"

echo "Reset done:"
echo "  - $LAST_FILE set to 1"
echo "  - $TOT_FILE cleared (header only)"</div>

                <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">5) inc_q3_recompute_full.sh ‚Äî Full Rebuild (Optional)</h4>
                <div class="content-text">
                    If your input file was replaced or got smaller, recompute all totals from scratch:
                </div>

                <div class="code-block">#!/usr/bin/env bash
set -u

INPUT="${1:-ModifiedData.txt}"
STATE_DIR="state"
LAST_FILE="$STATE_DIR/last_line.txt"
TOT_FILE="$STATE_DIR/q3_totals.csv"

[ -f "$INPUT" ] || { echo "ERROR: $INPUT not found"; exit 2; }
mkdir -p "$STATE_DIR"

declare -A TOTAL

# Skip header (line 1) and sum everything
tail -n +2 "$INPUT" | while IFS="," read -r id age dob gender socio school grade att gpa disc act parent grad drop loc
do
  school="${school:-Unknown}"
  disc="${disc:-0}"
  TOTAL["$school"]=$(( ${TOTAL["$school"]:-0} + disc ))
done

# Write totals file
{
  echo "SchoolType,TotalIncidents"
  for k in "${!TOTAL[@]}"; do
    printf "%s,%s\n" "$k" "${TOTAL[$k]}"
  done | sort
} > "$TOT_FILE"

# Bookmark to end
total_lines=$(wc -l < "$INPUT")
echo "$total_lines" > "$LAST_FILE"

echo "Full recompute done:"
echo "  - $TOT_FILE refreshed from scratch"
echo "  - $LAST_FILE set to $total_lines"</div>

                <div class="warning-box">
                    <div class="box-title">
                        <i class="fas fa-play"></i>
                        Daily Usage Workflow
                    </div>
                    <div class="content-text">
                        <strong>Once at the start:</strong>
                    </div>
                    <div class="code-block">chmod +x inc_*.sh
./inc_setup.sh</div>
                    
                    <div class="content-text">
                        <strong>Whenever ModifiedData.txt gets more rows:</strong>
                    </div>
                    <div class="code-block">./inc_q3_update.sh
./inc_q3_show.sh</div>
                    
                    <div class="content-text">
                        <strong>If the file got replaced/shrunk (CI/CD refresh, correction, etc.):</strong>
                    </div>
                    <div class="code-block">./inc_q3_recompute_full.sh   # or ./inc_q3_reset.sh then ./inc_q3_update.sh</div>
                </div>

                <div class="info-box">
                    <div class="box-title">
                        <i class="fas fa-lightbulb"></i>
                        Advanced Concepts Demonstrated
                    </div>
                    <ul class="feature-list">
                        <li><strong>State Management:</strong> Using bookmark files to track processing progress</li>
                        <li><strong>Incremental Processing:</strong> Processing only new data since last run</li>
                        <li><strong>Data Persistence:</strong> Maintaining running totals across script executions</li>
                        <li><strong>Error Recovery:</strong> Detecting file changes and providing recovery options</li>
                        <li><strong>Defensive Programming:</strong> Comprehensive error checking and safe defaults</li>
                        <li><strong>File System Operations:</strong> Creating directories, managing multiple state files</li>
                        <li><strong>Process Optimization:</strong> Using <code>tail -n +N</code> for efficient partial file reading</li>
                        <li><strong>Data Integrity:</strong> Validating file consistency before processing</li>
                    </ul>
                </div>

                <div class="info-box">
                    <div class="box-title">
                        <i class="fas fa-clipboard-list"></i>
                        Summary: Incremental Q3 (Total Incidents by SchoolType)
                    </div>
                    <div class="content-text">
                        <strong>Task:</strong> Incremental Q3 (Total Incidents by SchoolType)<br>
                        <strong>Steps:</strong>
                    </div>
                    <ol style="margin: 10px 0; padding-left: 20px; line-height: 1.8;">
                        <li>Keep bookmark in <code>state/last_line.txt</code></li>
                        <li>Read only new rows (<code>tail -n +N</code>); update per-SchoolType totals</li>
                        <li>Persist totals to <code>state/q3_totals.csv</code> (sorted)</li>
                        <li>Advance bookmark to current end of file</li>
                    </ol>
                </div>
            </div>
        </section>

        <!-- Exam Questions -->
        <section id="exam-questions" class="content-section">
            <h2 class="section-title">
                <i class="fas fa-graduation-cap"></i>
                Tricky Exam-Style Questions
            </h2>
            
            <div class="exercise-section">
                <h3 class="exercise-title">
                    <i class="fas fa-fire"></i>
                    üî• Tricky Text File Handling Challenges
                </h3>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">1. The Vanishing Data Mystery</h4>
                    <div class="content-text">
                        You have a file story.txt containing:
                    </div>
                    <div class="code-block">Once upon a time
in a faraway land</div>
                    <div class="content-text">
                        <strong>Task:</strong> Write a program to add this line at the end: <code>they lived happily ever after</code> 
                        ‚Ä¶but without erasing any existing text.
                    </div>
                    <div class="warning-box">
                        <div class="box-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Hidden traps
                        </div>
                        <ul style="margin: 0; padding-left: 20px;">
                            <li>If you open with the wrong mode, you'll lose the story</li>
                            <li>Do you need a newline before appending?</li>
                            <li>Pointer position matters</li>
                        </ul>
                    </div>
                </div>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">2. Partial Overwrite Surgery</h4>
                    <div class="content-text">
                        You have a file quote.txt: <code>Knowledge is power.</code>
                    </div>
                    <div class="content-text">
                        <strong>Task:</strong> Without creating a new file, change the text to: <code>Knowledge is Python.</code>
                    </div>
                    <div class="warning-box">
                        <div class="box-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Hidden traps
                        </div>
                        <ul style="margin: 0; padding-left: 20px;">
                            <li>If you open in append mode, nothing happens</li>
                            <li>If you open in write mode, you lose everything</li>
                            <li>You must move the file pointer to exactly the right spot</li>
                        </ul>
                    </div>
                </div>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">3. The Disappearing Read Problem</h4>
                    <div class="content-text">
                        You write this:
                    </div>
                    <div class="code-block">with open("data.txt", "w+") as f:
    f.write("Line 1\nLine 2\nLine 3\n")
    print(f.read())</div>
                    <div class="content-text">
                        <strong>Question:</strong> Why does this print nothing?<br>
                        <strong>Challenge:</strong> Fix it without reopening the file.
                    </div>
                </div>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">4. The Reverse Line Reader</h4>
                    <div class="content-text">
                        Write a program to read a file lines.txt and print its lines in reverse order (last line first) without loading the whole file into memory at once.
                    </div>
                    <div class="warning-box">
                        <div class="box-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Hidden traps
                        </div>
                        <ul style="margin: 0; padding-left: 20px;">
                            <li>readlines() loads entire file (forbidden here)</li>
                            <li>You must use pointer tricks (seek()) or chunk reading</li>
                            <li>Beware of trailing newline at EOF</li>
                        </ul>
                    </div>
                </div>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">5. The Sneaky Mode Swap</h4>
                    <div class="content-text">
                        You have:
                    </div>
                    <div class="code-block">with open("mystery.txt", "r+") as f:
    f.write("HELLO")
    print(f.read())</div>
                    <div class="content-text">
                        The file originally had: <code>abcdefghij</code>
                    </div>
                    <div class="content-text">
                        <strong>Question:</strong> What gets printed? Why?<br>
                        <strong>Follow-up:</strong> Modify code so that it prints the entire final file content without reopening.
                    </div>
                </div>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">6. The "Double Append" Puzzle</h4>
                    <div class="content-text">
                        Append two lines to log.txt:
                    </div>
                    <div class="code-block">[INFO] First message
[INFO] Second message</div>
                    <div class="content-text">
                        ‚Ä¶but do it in such a way that after writing the first line, you read the whole file before writing the second ‚Äî all in the same with block.
                    </div>
                    <div class="warning-box">
                        <div class="box-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Hidden traps
                        </div>
                        <ul style="margin: 0; padding-left: 20px;">
                            <li>In append mode, pointer starts at end</li>
                            <li>If you try to read right after writing, you'll see nothing unless‚Ä¶</li>
                        </ul>
                    </div>
                </div>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">7. Selective Line Replacement</h4>
                    <div class="content-text">
                        In tasks.txt, find the line that says: <code>Task 3: Pending</code>
                        ‚Ä¶and replace it with: <code>Task 3: Done</code>
                        without touching other lines.
                    </div>
                    <div class="warning-box">
                        <div class="box-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Hidden traps
                        </div>
                        <ul style="margin: 0; padding-left: 20px;">
                            <li>Text files have no true "insert" ‚Äî overwriting can cause leftover characters</li>
                            <li>You may need to rewrite the whole file from scratch in memory</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="exercise-section">
                <h3 class="exercise-title">
                    <i class="fas fa-brain"></i>
                    Practice Exercises
                </h3>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">A. Text basics</h4>
                    <ul class="exercise-list">
                        <li>Create notes.txt with three lines using w</li>
                        <li>Append two more lines using a</li>
                        <li>Read back and print line numbers (1: ...) as you go</li>
                    </ul>
                </div>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">B. r+ overwrite</h4>
                    <ul class="exercise-list">
                        <li>File contains: HELLO PYTHON</li>
                        <li>Overwrite starting at byte 6 with WORLD</li>
                        <li>Print final file content and explain why it looks the way it does</li>
                    </ul>
                </div>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">C. Binary chunking</h4>
                    <ul class="exercise-list">
                        <li>Copy a large file using 16 KB chunks</li>
                        <li>Measure how many chunks were written</li>
                    </ul>
                </div>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">D. Tail utility</h4>
                    <ul class="exercise-list">
                        <li>Implement tail("app.log", 25) and compare its output to the last 25 lines produced by a simple full-read</li>
                        <li>Time both approaches on a large file</li>
                    </ul>
                </div>

                <div class="subsection">
                    <h4 style="color: var(--primary-color); margin: 20px 0 10px 0;">E. Safe read after write</h4>
                    <ul class="exercise-list">
                        <li>Using w+, write 3 lines, then read them without reopening (remember seek(0)!)</li>
                    </ul>
                </div>
            </div>

            <div class="exercise-section">
                <h3 class="exercise-title">
                    <i class="fas fa-chart-line"></i>
                    When to choose which mode (mental model)
                </h3>

                <ul class="feature-list">
                    <li><strong>Only reading:</strong> r / rb</li>
                    <li><strong>Create new or wipe old:</strong> w / wb (dangerous‚Äîdouble-check!)</li>
                    <li><strong>Add to end:</strong> a / ab</li>
                    <li><strong>Read & edit without wiping:</strong> r+ / rb+</li>
                    <li><strong>Write then read (fresh file):</strong> w+ / wb+</li>
                    <li><strong>Append then read:</strong> a+ / ab+ (use seek(0) to read from start)</li>
                </ul>
            </div>
        </section>

        <!-- Quick Reference -->
        <section class="content-section">
            <h2 class="section-title">
                <i class="fas fa-bookmark"></i>
                Quick Reference (Cheatsheet)
            </h2>
            
            <div class="code-block"># Open
with open("file.txt", "r", encoding="utf-8") as f: ...

# Modes
# r, w, a, r+, w+, a+  (+ 'b' for binary)

# Read
f.read()           # all
f.read(n)          # n chars/bytes
f.readline()       # next line
for line in f: ... # stream lines

# Write / Append
f.write("text\n")

# Pointer
f.tell()
f.seek(offset, whence=0)   # 0=start, 1=current, 2=end</div>
        </section>
    </div>

    <!-- Scroll to top button -->
    <button class="scroll-top" id="scrollTop">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        // Theme Management
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                themeIcon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Initialize theme from localStorage
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const themeIcon = document.getElementById('theme-icon');
            
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
            }
        }

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Scroll to top functionality
        const scrollTopBtn = document.getElementById('scrollTop');
        
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                scrollTopBtn.classList.add('visible');
            } else {
                scrollTopBtn.classList.remove('visible');
            }
        });

        scrollTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        // Progress tracking
        function trackProgress() {
            let visitedPages = JSON.parse(localStorage.getItem('visitedPages') || '[]');
            if (!visitedPages.includes('file-handling.html')) {
                visitedPages.push('file-handling.html');
                localStorage.setItem('visitedPages', JSON.stringify(visitedPages));
            }
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            trackProgress();
        });
    </script>
</body>
</html>
